Citrix Admin URL RCE (CVE-2019-19781)
=====================================


From the [Citrix report](https://support.citrix.com/article/CTX267679), it's
look like using a crafted URL you can bypass user permissions. The fix is the
following:

```
enable ns feature responder
add responder action respondwith403 respondwith "\"HTTP/1.1 403 Forbidden\r\n\r\n\""
add responder policy ctx267027 "HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/vpns/\") && (!CLIENT.SSLVPN.IS_SSLVPN || HTTP.REQ.URL.DECODE_USING_TEXT_MODE.CONTAINS(\"/../\"))" respondwith403
bind responder global ctx267027 1 END -type REQ_OVERRIDE
save config
```

A legit URL is `https://<host>/vpn/tmindex.html`, then you should access the admin
panel using the custom URL `https://<host>/vpn/..%2fvpns/apps.html`.

You can test this vulnerability by downloading some executable files:
```
/vpn/../vpns/services.html
/vpn/../vpns/cfg/smb.conf
```

You can check if a server is patched because it returns the following line as a
HTTP response:

```
HTTP/1.1 403 Forbidden
```
