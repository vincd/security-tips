<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Vincent D. (@vincd)">
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Challs Dont Matter Anymore - Security Tips</title>
  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Challs Dont Matter Anymore";
    var mkdocs_page_input_path = "sdr/challs-dont-matter-anymore/hackingforsoju.md";
    var mkdocs_page_url = "/sdr/challs-dont-matter-anymore/hackingforsoju/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script> 
</head>

<body class="ready sticky">
  <button class="sidebar-toggle">
    <div class="sidebar-toggle-button">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </button>

  <main>
    
    <aside class="sidebar">
      <div class="search">
	<div class="input-wrap">
		<form action="../../../search.html" method="get">
			<input type="search" name="q" placeholder="Search docs" title="Type search term here" />
		</form>
	</div>
</div>

      <h1 class="app-name"><a class="app-name-link" data-nosearch="" href="/">Security Tips</a></h1>

      <div class="sidebar-nav">
        <ul>
    	    
          
          <li class="bold">
		        
    <a class="section-link" href="../../..">Home</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../aws/">AWS</a>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">Containers</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../docker/">Docker</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../kubernetes/">Kubernetes</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../windows/">Windows</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../linux/">Linux</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../xxe/">XXE</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../zip/">Zip</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../kafka/">Kafka</a>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">Web</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../xss/">XSS</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../API/">API</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../oauth/">OAuth</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../path-traversal/">Path Traversal</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../graphql/">GraphQL</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../git/">Git</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../jwt/">JWT</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../iis/">IIS</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../nginx/">Nginx</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">CVE</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-1388/">CVE-2019-1388</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-11510/">CVE-2019-11510</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-11581/">CVE-2019-11581</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-16759/">CVE-2019-16759</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link active">SDR</span>
    <ul>
                <li class="active">
                    
    <a class="section-link" href="./">Challs Dont Matter Anymore</a>
    <ul>
            
    
    <ul>
    
        <li><a class="" href="#description">Description</a></li>
    
        <li><a class="" href="#analysis">Analysis</a></li>
    
        <li><a class="" href="#source-code">Source code</a></li>
    
    </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../lit-fam/hackingforsoju/">lit-fam</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">Misc</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../firefox/">Firefox</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../iscsi/">ISCSI</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../reverse-shell/">Reverse Shell</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../waf/">WAF</a>
                </li>
    </ul>
          </li>
          
        </ul>
      </div>
    </aside>

    <section class="content">
      
      <article class="markdown-section" id="main">
        <div role="main">
          <div class="section">
            
              <h1 id="write-up-inshack-2019-challs-dont-matter-anymore">WRITE UP - INS'HACK 2019: CHALLS DONT MATTER ANYMORE</h1>
<p>This is a write-up for the challs dont matter anymore challenge of INS’hAck 2019 by LarsH on behalf of team HackingForSoju.</p>
<h2 id="description">Description</h2>
<blockquote>
<p>You’ve definitely pissed off these aliens by breaking their secret transmission methods ! Now they have 8 devices transmitting on the same frequency, using 32-bit synchronous CDMA.</p>
<p>One of the devices is sending unencrypted codes, this is our chance ! The intercepted transmission is in this file.</p>
</blockquote>
<p>Attached is the file CDMA_interception.wav.</p>
<h2 id="analysis">Analysis</h2>
<p>So we are given the information that the data is sent using CDMA. Several signals can be transmitted with CDMA using orthogonal codes, wikipedia page.</p>
<p>If we look at how the input data looks in Audacity, we can see that the signal seems to be partwise constant in blocks of 100 samples with some noise added.</p>
<p><img alt="Audacity" src="../audacity.png" /></p>
<p>We can compute the mean value for every time slot and plot.</p>
<pre><code class="language-python">wav = wavio.read('CDMA_interception.wav')
means = wav.data.reshape((wav.data.size/100,100)).mean(axis=1)
plt.hist(means,bins=1000)
plt.plot(sorted(means),range(len(means)))
</code></pre>

<p><img alt="Histogram" src="../means.png" /></p>
<p>The mean values for the time slots separate into several distinct groups, depending of what the transmitters send. This is the interference pattern. The first side groups are located at +/-7500, so we can compute the number of the bin by dividing by 7500 and rounding to the nearest integer.</p>
<p>We were given that the transmission uses 32-bit codes, so we can reshape the data into a matrix with 32 columns and find an orthogonal base in that data set. There are several ways, but LLL-lattice reduction worked fine.</p>
<pre><code>matrix = (means.reshape((means.size/32,32))/7500.0).round().astype(int)
base = reduceLattice(matrix)
</code></pre>

<p>This gave 8 base vectors that span the data set. (It was at this stage the smell of flag started to show, as we were given the information that there were 8 devices.) The base was:</p>
<pre><code>[ 1, 1, 1, 1,-1,-1, 1, 1,-1,-1, 1,-1, 1,-1,-1,-1, 1,-1,-1,-1,-1,-1, 1,-1, 1, 1, 1, 1,-1,-1, 1, 1]
[-1,-1, 1, 1, 1,-1,-1, 1,-1, 1, 1,-1,-1,-1, 1,-1, 1, 1, 1, 1,-1, 1, 1,-1, 1,-1,-1,-1, 1, 1, 1, 1]
[ 1,-1, 1, 1, 1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 1, 1,-1, 1,-1,-1,-1,-1,-1, 1,-1,-1, 1, 1, 1,-1,-1, 1]
[-1, 1, 1, 1,-1,-1,-1,-1, 1,-1, 1, 1, 1,-1,-1,-1,-1, 1, 1, 1, 1,-1,-1, 1,-1, 1,-1, 1, 1, 1, 1, 1]
[ 0, 1,-1,-1,-1,-2, 1, 2, 0, 2, 0,-2, 0, 0, 0,-1, 3,-1, 2,-1,-1,-1, 3,-3, 0,-2, 0,-1,-1, 0, 1, 0]
[-1, 0, 0, 0,-2, 1, 2,-1, 1,-1, 3, 1, 3,-1,-1, 0, 0,-2,-1, 2, 2, 0, 0, 0, 1, 3, 1, 2, 0,-1, 0, 1]
[-1, 1,-1, 1,-1,-1,-1, 1, 1, 1,-1,-1, 1, 1, 1,-1, 1, 1, 1,-1,-1,-1,-1, 1,-1,-1, 1,-1,-1,-1, 1,-1]
[ 1, 0, 2, 0, 2, 1, 2, 1,-1, 1, 1,-1,-1, 1,-1,-2, 0,-2,-1, 0,-2, 2, 2,-2, 3, 1,-1, 0, 0, 1, 2,-1]
</code></pre>

<p>We can see that this base is not perfect, as all base vectors should have been 1 or -1. This is because LLL minimizes vectors with the L2-norm, not the L-inf-norm.</p>
<p>But the base was good enough to use, if we just reduce the rawdata after decoding with this base. To decode the data, we take the dot product with the base and reduce again:</p>
<pre><code class="language-python">rawdata = base.dot(matrix.transpose())
data = reduceLattice(rawdata)
</code></pre>

<h2 id="source-code">Source code</h2>
<p>This script solves the challenge:</p>
<pre><code class="language-python">import wavio, fpylll, bitarray, numpy

def reduceLattice(lattice):
    A = fpylll.IntegerMatrix.from_matrix(lattice)
    M = fpylll.GSO.Mat(A)
    M.update_gso()
    L = fpylll.LLL.Reduction(M)
    L()
    return numpy.array(map(list, A), dtype=int)

wav = wavio.read('CDMA_interception.wav')

# Compute mean values for every time slot
means = wav.data.reshape((wav.data.size/100,100)).mean(axis=1)

# Convert mean values to integers and reshape into matrix of data
matrix = (means.reshape((means.size/32,32))/7500.0).round().astype(int)

# Get reduced basis for matrix through lattice reduction
base = reduceLattice(matrix)[:8]

# Compute raw data through dot product with basis
rawdata = base.dot(matrix.transpose())

# Reduce raw data more, as base is not perfect
data = reduceLattice(rawdata)

# To through all 8 data streams and print flag if found
for d in data:
    plaintext = bitarray.bitarray(list(d&lt;0),endian='big').tobytes()
    if 'INSA' in plaintext:
        print plaintext
</code></pre>

<p>Running it gives the flag:</p>
<pre><code>$ python solve.py
Oh hi, I see you've found my secret device. Want a flag ? Here you go INSA{Elektr0nenklange_Aus_d3m_R4di0l4nD}
</code></pre>
            
          </div>
          <footer>
  <hr/>
  <div class="content-info">
    <p>Build with ❤️ by <a href="https://github.com/vincd" target="_blank" rel="noopener noreferrer">vincd</a>.</p>
  </div>
</footer>
      
        </div>
      </article>
    </section>
  </main>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../../cve/CVE-2019-16759/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../lit-fam/hackingforsoju/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js"></script>
    <script src="../../../js/prism-core.min.js"></script>
    <script src="../../../js/prism-clike.min.js"></script>
    <script src="../../../js/prism-yaml.min.js"></script>
    <script src="../../../js/prism-powershell.min.js"></script>
    <script src="../../../js/prism-bash.min.js"></script>
    <script src="../../../js/prism-nginx.min.js"></script>
    <script src="../../../js/prism-python.min.js"></script>
    <script src="../../../js/prism-markup.min.js"></script>
    <script src="../../../search/main.js"></script>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-128044070-2', 'security-tips.vincd.com');
      ga('send', 'pageview');
    </script>
    

</body>
</html>
