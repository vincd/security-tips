<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="search" href="/opensearch.xml" type="application/opensearchdescription+xml" title="Security Tips">

  
  <meta name="author" content="Vincent D. (@vincd)">
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>lit-fam - Security Tips</title>
  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "lit-fam";
    var mkdocs_page_input_path = "sdr/lit-fam/hackingforsoju.md";
    var mkdocs_page_url = "/sdr/lit-fam/hackingforsoju/";
  </script>
   
</head>

<body class="ready sticky">
  <button class="sidebar-toggle">
    <div class="sidebar-toggle-button">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </button>

  <main>
    
    <aside class="sidebar">
      <div class="search">
	<div class="input-wrap">
		<form action="../../../search.html" method="get">
			<input type="search" name="q" placeholder="Search docs" title="Type search term here" />
		</form>
	</div>
</div>

      <h1 class="app-name"><a class="app-name-link" data-nosearch="" href="/">Security Tips</a></h1>

      <div class="sidebar-nav">
        <ul>
    	    
          
          <li class="bold">
		        
    <a class="section-link" href="../../..">Home</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../ports/">Ports</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../android/">Android</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../cloud/">Cloud</a>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">Containers</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../docker/">Docker</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../kubernetes/">Kubernetes</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">Windows</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../windows/">General</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../eventid/">Event ID</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../powershell/">Powershell</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../linux/">Linux</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../ssh/">SSH</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../ftp/">FTP</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../xxe/">XXE</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../zip/">Zip</a>
          </li>
          
          <li class="bold">
		        
    <a class="section-link" href="../../../kafka/">Kafka</a>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">Web</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../xss/">XSS</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../API/">API</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../oauth/">OAuth</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../path-traversal/">Path Traversal</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../graphql/">GraphQL</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../php/">PHP</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../jwt/">JWT</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../iis/">IIS</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../nginx/">Nginx</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">SQL</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../postgresql/">PostgreSQL</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">CVE</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2016-3714/">CVE-2016-3714</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-1388/">CVE-2019-1388</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-11510/">CVE-2019-11510</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-11581/">CVE-2019-11581</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-16759/">CVE-2019-16759</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2019-19781/">CVE-2019-19781</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2020-0618/">CVE-2020-0618</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2020-0688/">CVE-2020-0688</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2020-1938/">CVE-2020-1938</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/CVE-2020-5902/">CVE-2020-5902</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../cve/ffmpeg/">FFmpeg HLS vulnerability</a>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link active">SDR</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../challs-dont-matter-anymore/hackingforsoju/">Challs Dont Matter Anymore</a>
                </li>
                <li class="active">
                    
    <a class="section-link" href="./">lit-fam</a>
    <ul>
            
    
    <ul>
    
        <li><a class="" href="#description">Description</a></li>
    
        <li><a class="" href="#initial-analysis">Initial analysis</a></li>
    
        <li><a class="" href="#decoding-fsk">Decoding FSK</a></li>
    
        <li><a class="" href="#decoding-am">Decoding AM</a></li>
    
        <li><a class="" href="#solution-script">Solution script</a></li>
    
    </ul>
    

    </ul>
                </li>
    </ul>
          </li>
          
          <li class="bold">
		        
    <span class="section-link ">Misc</span>
    <ul>
                <li class="">
                    
    <a class="section-link" href="../../../firefox/">Firefox</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../citrix/">Citrix</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../git/">Git</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../iscsi/">ISCSI</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../java/">Java</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../python/">Python</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../node/">Node</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../reverse-shell/">Reverse Shell</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../spring_boot/">Spring Boot</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../waf/">WAF</a>
                </li>
                <li class="">
                    
    <a class="section-link" href="../../../miscs/">Others</a>
                </li>
    </ul>
          </li>
          
        </ul>
      </div>
    </aside>

    <section class="content">
      
      <article class="markdown-section" id="main">
        <div role="main">
          <div class="section">
            
              <h1 id="write-up-inshack-2019-lit-fam">WRITE UP - INS'HACK 2019: LIT FAM</h1>
<p>This is a write-up for the LIT FAM dual challenge of INS’hAck 2019 by LarsH on behalf of team HackingForSoju.</p>
<h2 id="description">Description</h2>
<blockquote>
<p>We have a proof of extraterrestrial life ! Or is it just a random amateur radio operator ?</p>
<p>Anyway, here is a strange RF interception. The file contains two independent flags</p>
</blockquote>
<p>The RF interception was given as a WAV file, and The A-part flag matches INSA{[A-Z]+} and the F-part matches INSA{[A-Za-z0-9_]+}.</p>
<h2 id="initial-analysis">Initial analysis</h2>
<p>If we open the WAV file in Audacity and zoom in, we can see that the file consists of sine-waves with two different frequencies. This is called FSK modulation, the changing frequency is used to encode the data.</p>
<p><img alt="FSK-data" src="../fsk.png" />
If we zoom out a bit more, we can see that the amplitude of the FSK signal varies and encodes an analog signal. This is AM, amplitude modulation, the amplitude is used to encode the data.</p>
<p><img alt="AM-data" src="../am.png" /></p>
<h2 id="decoding-fsk">Decoding FSK</h2>
<p>There are several ways to decode an FSK signal, but as we have a pure sine wave there is a special trick.</p>
<p>The trick is based on the fact that the second derivative of <code>sin(w*x)</code> is <code>-w*w * sin(w*x)</code>. If we take the second derivative and divide by the original function value we get <code>-w**2</code>, so we can extract the time.</p>
<p>We have a sampled sine wave in discrete time <code>f(n) = A * sin(n*dt*w)</code>, so we can not get the exact derivative, but we can use approximations and simplifications. It will be enough to decode the data.</p>
<p>The second derivative (ignoring discretization constant) can be approximated with</p>
<pre><code class="language-none">f''(n) = f(n-1) - 2*f(n) + f(n+1) =
       = A * (sin(n*dt*w - dt*w) - 2*sin(n*dt*w) + sin(n*dt*w + dt*w)) =
       = A * (sin(n*dt*w)*cos(dt*w) - cos(n*dt*w)*sin(dt*w) - 2*sin(n*dt*w) + sin(n*dt*w)*cos(dt*w) + cos(n*dt*w)*sin(w*t) =
       = A * (2*sin(n*dt*w)*cos(dt*w) - 2*sin(n*dt*w)) =
       = A * 2 * sin(n*dt*w) * (cos(dt*w) - 1)
</code></pre>
<p>so the value of f''(n) / f(n) is</p>
<pre><code class="language-none">f''(n) / f(n) = (A * 2 * sin(n*dt*w) * (cos(dt*w) - 1)) / A*sin(n*dt*w) =
              = 2 * (cos(dt*w - 1)
</code></pre>
<p>This expression only depends on the frequency of the signal, wich is the quantity we want to extract!</p>
<p>We can now decode and plot the raw frequency dependent data:</p>
<pre><code class="language-python">import wavio
from matplotlib import pyplot as plt
wav = wavio.read('FAM.wav')
l = [(a-2*b+c) / float(b) for a,b,c in zip(wav.data[:500], wav.data[1:], wav.data[2:])]
plt.plot(l)
plt.show()
</code></pre>
<p><img alt="Plot of the decoded signal" src="../plot.png" />
The frequency signal is stable at -0.1 and -0.4, except for at the boundaries where the bit level changes. The bits change every 20th sample, so we can reduce the data set by picking every 20th sample, starting at sample 10. We compute the bit value using 0.25 as a threshold value.</p>
<pre><code class="language-python">&gt;&gt;&gt; b = [int(e&lt;-0.25) for e in l][10::20]
&gt;&gt;&gt; numpy.array(b[:80]).reshape((10,8))
array([[1, 0, 1, 1, 1, 1, 1, 0],
       [1, 1, 0, 1, 0, 0, 1, 0],
       [1, 1, 0, 1, 1, 1, 0, 0],
       [1, 0, 1, 1, 1, 1, 1, 0],
       [1, 1, 1, 0, 1, 0, 0, 0],
       [1, 1, 0, 1, 0, 0, 0, 0],
       [0, 1, 1, 0, 0, 1, 1, 0],
       [1, 0, 1, 1, 1, 1, 1, 0],
       [1, 0, 0, 0, 0, 0, 1, 0],
       [1, 1, 0, 1, 0, 0, 1, 0]])
</code></pre>
<p>We can see that the the last bits align nicely and we should be able to decode this as ASCII. However, the challenge creators put in a small trick. The bytes are stored in big endian with only 7 bits given for the first byte. One way to decode the bits is to add a zero to the beginning and decode using bitarray.</p>
<h2 id="decoding-am">Decoding AM</h2>
<p>The simplest circuit to decode an AM signal with is a diode receiver. The digital equivalent is to use the abs() function, we can just write back the rectified data to a WAV-file and listen to it.</p>
<h2 id="solution-script">Solution script</h2>
<p>This is the final solution script:</p>
<pre><code class="language-none">import wavio, bitarray
wav = wavio.read('FAM.wav')
wavio.write('rectified.wav', abs(wav.data), wav.rate)
l = [(a-2*b+c) / float(b) for a,b,c in zip(wav.data[:10000], wav.data[1:], wav.data[2:])]
print bitarray.bitarray([0]+[int(e&lt;-0.25) for e in l][10::20]).tobytes()
</code></pre>
<p>Running the script prints the the flag</p>
<pre><code class="language-none">_in_th3_AiR_4_u_4nd_Me}INSA{iS_in_th3_AiR_4_u_4nd_Me}INSA{iS_ih*
</code></pre>
<p>and if we listen to the file rectified.wav we can hear some space sounds followed by the voice message:</p>
<blockquote>
<p>The flag is I, N, S, A, opening bracket, RADIOACTIVITY, closing bracket. All letters are in uppercase.</p>
</blockquote>
<p>so the flag is <code>INSA{RADIOACTIVITY}.</code></p>
            
          </div>
          <footer>
  <hr/>
  <div class="content-info">
    <p>Build with ❤️ by <a href="https://github.com/vincd" target="_blank" rel="noopener noreferrer">vincd</a>.</p>
  </div>
</footer>
      
        </div>
      </article>
    </section>
  </main>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../challs-dont-matter-anymore/hackingforsoju/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../../firefox/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script async src="../../../js/theme.js"></script>
    <script async src="../../../js/prism.min.js"></script>
    <script src="../../../search/main.js"></script>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-128044070-4', 'security-tips.vincd.com');
      ga('send', 'pageview');
    </script>
    

</body>
</html>
